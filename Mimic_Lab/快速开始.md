# 🤖 G1 机器人舞蹈训练 - 快速开始

## ⚡ 一键训练（推荐）

```bash
# 1. 激活 IsaacLab 环境
conda activate isaaclab

# 2. 进入项目目录
cd /home/lyz/Desktop/code/robo_dance/Robocup_Lab

# 3. 配置 WandB（首次使用）
wandb login
export WANDB_ENTITY=你的组织名  # 注意：是组织名，不是个人用户名

# 4. 一键运行训练脚本
./quick_train.sh
```

## 📝 详细步骤（手动执行）

### 第一步：安装包
```bash
conda activate isaaclab
cd /home/lyz/Desktop/code/robo_dance/Robocup_Lab
python -m pip install -e source/robocup_lab
```

### 第二步：配置 WandB
```bash
wandb login
export WANDB_ENTITY=你的组织名
```

在 [WandB 网站](https://wandb.ai) 创建 Registry Collection：
- 名称: "Motions"
- 类型: "All Types"

### 第三步：转换舞蹈数据
```bash
python scripts/csv_to_npz.py \
  --input_file dance_motion/douyin1_g1.csv \
  --input_fps 30 \
  --output_name douyin1_dance \
  --robot g1 \
  --headless
```

### 第四步：开始训练
```bash
python scripts/rsl_rl/train.py \
  --task=Tracking-Flat-G1-v0 \
  --registry_name ${WANDB_ENTITY}-org/wandb-registry-motions/douyin1_dance \
  --headless \
  --logger wandb \
  --log_project_name g1_dance_training \
  --run_name douyin1_v1 \
  --num_envs 4096
```

### 第五步：测试训练结果
```bash
python scripts/rsl_rl/play.py \
  --task=Tracking-Flat-G1-v0 \
  --num_envs=2 \
  --wandb_path=${WANDB_ENTITY}/g1_dance_training/运行ID
```

## 🎛️ 常用参数调整

### 调整训练环境数量（根据 GPU 内存）
```bash
--num_envs 2048   # 少内存
--num_envs 4096   # 中等内存（推荐）
--num_envs 8192   # 大内存
```

### 选择舞蹈片段训练
```bash
python scripts/csv_to_npz.py \
  --input_file dance_motion/douyin1_g1.csv \
  --frame_range 0 500 \    # 只训练前 500 帧
  --output_name douyin1_short \
  --robot g1 \
  --headless
```

### 添加平滑过渡
```bash
python scripts/csv_to_npz.py \
  --input_file dance_motion/douyin1_g1.csv \
  --prepend_frames 50 \    # 开始前添加 50 帧过渡
  --append_frames 50 \     # 结束后添加 50 帧过渡
  --output_name douyin1_smooth \
  --robot g1 \
  --headless
```

## 📊 监控训练

- **WandB 网址**: https://wandb.ai/你的组织名/g1_dance_training
- **关键指标**:
  - `rewards/episode_return`: 越高越好（目标 > 0.8）
  - `train/mean_reward`: 训练过程奖励
  - `losses/policy_loss`: 策略损失
  - `losses/value_loss`: 价值函数损失

## ❓ 常见问题

### GPU 内存不足
减少 `--num_envs` 参数，例如改为 2048 或 1024

### WandB 认证失败
```bash
# 重新登录
wandb login
# 确认使用组织名而非个人用户名
export WANDB_ENTITY=组织名
```

### CSV 格式错误
确保 CSV 文件：
- 每行一个时间步
- 包含所有 G1 关节角度（36 个值）
- 数值为弧度制

### 训练速度慢
- 使用 `--headless` 参数
- 增加 `--num_envs` （如果 GPU 内存足够）
- 确保使用 GPU 训练

## 📁 相关文件

- **详细指南**: `TRAINING_GUIDE.md`
- **训练脚本**: `quick_train.sh`
- **配置文件**: `source/robocup_lab/robocup_lab/tasks/tracking/config/g1/`
- **舞蹈数据**: `dance_motion/douyin1_g1.csv`

## 🎯 预期训练时间

- **简单动作**: 1-2 小时（2000 次迭代）
- **复杂舞蹈**: 3-5 小时（5000 次迭代）
- **GPU**: 推荐 RTX 3090 或更高

---

**更多帮助**: 查看 `TRAINING_GUIDE.md` 获取完整文档

