# 命令行控制器使用说明

## 概述

新的命令行控制器使用独立线程接收终端输入，避免了pygame键盘控制的问题（需要窗口焦点、容易与文本输入冲突）。

## 优势

1. **纯命令行操作** - 在终端直接输入命令，不需要窗口焦点
2. **实时响应** - 使用独立线程，不阻塞主程序
3. **简单直观** - 数字和字母命令，易于记忆
4. **无冲突** - 不会与其他应用的键盘输入冲突

## 命令列表

### 技能命令（输入数字）

| 命令 | 功能 | 说明 |
|------|------|------|
| 0 | 被动模式 | PASSIVE - 机器人进入被动状态 |
| 1 | 位置重置 | POS_RESET - 重置位置 |
| 2 | 站起来 | STAND_UP - 从摔倒状态站起 |
| 3 | 运动模式 | LOCO - 进入运动控制模式 |
| 4 | 技能1 | 舞蹈动作 |
| 5 | 技能2 | 功夫2动作 |
| 6 | 技能3 | 跳舞动作 |
| 7 | 技能4 | 功夫1动作 |
| 8 | 技能5 | ASAP动作 |

### 移动控制（在LOCO模式下）

| 命令 | 功能 | 说明 |
|------|------|------|
| w | 前进 | 增加前进速度，每次增加0.3 |
| s | 后退 | 增加后退速度，每次增加0.3 |
| a | 左移 | 增加左移速度，每次增加0.3 |
| d | 右移 | 增加右移速度，每次增加0.3 |
| q | 左转 | 增加左转速度，每次增加0.3 |
| e | 右转 | 增加右转速度，每次增加0.3 |
| x | 停止 | 将所有速度归零 |

### 其他命令

| 命令 | 功能 |
|------|------|
| h 或 help | 显示帮助信息 |
| exit, quit 或 q | 退出程序 |

## 使用示例

### 1. 测试命令行控制器

```bash
cd /home/qp/桌面/LZY/RoboMimicDeploy_G1_Kboard
python tools/test_command_input.py
```

这会启动一个简单的测试程序，你可以输入命令查看效果。

### 2. 运行Mujoco仿真

```bash
cd /home/qp/桌面/LZY/RoboMimicDeploy_G1_Kboard
python deploy_mujoco/deploy_mujoco.py
```

### 3. 典型操作流程

```
# 启动程序后，会显示帮助信息
请输入命令: 3         # 切换到运动模式
请输入命令: w         # 前进
请输入命令: w         # 再次前进（速度增加）
请输入命令: q         # 左转
请输入命令: x         # 停止移动
请输入命令: 6         # 执行跳舞技能
请输入命令: exit      # 退出程序
```

## 技术细节

### 实现原理

1. **独立线程** - 使用Python的`threading`模块创建独立的输入线程
2. **命令队列** - 使用`queue.Queue`在线程间传递命令
3. **非阻塞更新** - 主循环调用`update()`时处理命令队列，不会阻塞

### 速度控制说明

- 速度增量：每次0.3
- 最大速度：±1.0
- 可以连续输入同一命令来增加速度
- 使用`x`命令可以立即停止

### 与原手柄控制的区别

| 特性 | 手柄控制 | 命令行控制 |
|------|----------|------------|
| 输入方式 | 按钮和摇杆 | 键盘输入命令 |
| 速度控制 | 模拟摇杆（连续） | 离散增量 |
| 组合键 | 支持（如L1+A） | 单一命令 |
| 实时性 | 高 | 中等 |
| 易用性 | 需要手柄硬件 | 只需键盘 |

## 故障排除

### Q: 输入命令没有响应？

A: 确保你按下回车键提交命令。每个命令都需要回车确认。

### Q: 如何快速停止机器人？

A: 输入`x`然后回车，立即停止所有移动。

### Q: 可以同时控制多个方向吗？

A: 可以，速度是累加的。例如先输入`w`（前进），再输入`d`（右移），机器人会斜向移动。

### Q: 如何退出程序？

A: 输入`exit`、`quit`或`q`，然后回车。

## 代码结构

```
common/
  └── command_input_controller.py  # 命令行控制器实现

deploy_mujoco/
  └── deploy_mujoco.py             # 已修改为使用命令行控制器

tools/
  ├── test_command_input.py        # 测试脚本
  └── 命令行控制说明.md             # 本文档
```

## 未来改进

- [ ] 添加命令历史记录
- [ ] 支持命令宏（组合命令）
- [ ] 添加速度预设（慢/中/快）
- [ ] 支持配置文件自定义按键映射

