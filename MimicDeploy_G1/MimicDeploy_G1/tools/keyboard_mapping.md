# 键盘控制映射说明

## 概述
当没有检测到手柄时，系统会自动切换到键盘控制模式。键盘按键映射到手柄按钮，提供相同的控制功能。

## 按键映射表

### 基础按钮映射
| 手柄按钮 | 键盘按键 | 功能说明 |
|---------|---------|---------|
| A | 空格键 (Space) | 确认/跳跃 |
| B | ESC键 | 取消/返回 |
| X | X键 | 技能按钮 |
| Y | Y键 | 技能按钮 |
| L1 | Q键 | 左肩键 |
| R1 | E键 | 右肩键 |
| SELECT | Tab键 | 选择/菜单 |
| START | Enter键 | 开始/确认 |
| L3 | 左Shift键 | 左摇杆按下 |
| R3 | 右Shift键 | 右摇杆按下 |
| HOME | H键 | 主页/切换控制器 |

### 方向控制
| 功能 | 键盘按键 | 说明 |
|-----|---------|-----|
| 左摇杆 | WASD | W=上, A=左, S=下, D=右 |
| 右摇杆 | 方向键 | ↑=上, ←=左, ↓=下, →=右 |
| 十字键 | 方向键 | 与右摇杆共享 |

## 技能组合键

### 基础技能
- **被动模式**: Q + E (L1 + R1)
- **位置重置**: Enter (START)
- **摔倒爬起**: Q + X (L1 + X)

### 运动技能
- **行走模式**: E + 空格 (R1 + A)
- **技能1**: E + X (R1 + X)
- **技能2**: E + Y (R1 + Y)
- **技能3**: E + ESC (R1 + B)
- **技能4**: Q + Y (L1 + Y)
- **技能5 (ASAP)**: Q + 空格 (L1 + A)

## 使用说明

### 启动控制
1. 运行程序时，系统会自动检测手柄
2. 如果没有手柄，会自动切换到键盘模式
3. 控制台会显示当前使用的控制器类型

### 控制器切换
- 在键盘模式下，按 **H键** 可以尝试切换到手柄（如果连接了手柄）
- 系统会优先使用手柄，如果没有手柄则使用键盘

### 注意事项
1. **按键冲突**: 某些按键可能与其他程序冲突，建议在运行机器人控制程序时关闭其他可能占用键盘的程序
2. **按键保持**: 某些操作需要同时按下多个键，请确保能够同时按下所需的组合键
3. **摇杆模拟**: 键盘的WASD和方向键模拟摇杆，只能提供-1, 0, 1三个值，无法提供摇杆的连续值

## 故障排除

### 键盘无响应
1. 确保程序窗口处于焦点状态
2. 检查是否有其他程序占用了键盘输入
3. 尝试重新启动程序

### 无法切换到手柄
1. 确保手柄已正确连接
2. 检查手柄驱动是否正常
3. 尝试重新连接手柄后按H键切换

### 按键映射错误
1. 检查键盘布局是否为英文
2. 某些特殊键盘可能需要调整映射
3. 可以修改 `keyboard_controller.py` 中的按键映射

## 自定义映射

如果需要修改按键映射，可以编辑 `common/keyboard_controller.py` 文件中的 `key_mapping` 字典：

```python
self.key_mapping = {
    K_SPACE: KeyboardButton.A,      # 空格 -> A
    K_ESCAPE: KeyboardButton.B,     # ESC -> B
    # ... 其他映射
}
```

其中 `K_SPACE`, `K_ESCAPE` 等是pygame的按键常量，可以在pygame文档中查找完整的按键列表。

